<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.demo.dao.task.ScheduleJobMapper">



    <resultMap id="ScheduleJob" type="com.example.demo.pojo.quartz.ScheduleJob">
        <id column="id" property="id"></id>
        <result column="job_name" property="jobName"></result>
        <result column="description" property="description"></result>
        <result column="cron_expression" property="cronExpression"></result>
        <result column="bean_class" property="beanClass"></result>
<!--
        注意需要配置javaType 去寻找类型
-->
        <result column="job_status" javaType="com.example.demo.pojo.enums.JobStatus" property="jobStatus" typeHandler="com.example.demo.config.datasource.EnumTypeHandler"/>
        <result column="job_group" property="jobGroup"></result>

    </resultMap>

    <select id="findInitScheduleJobs" resultMap="ScheduleJob">
           SELECT id,job_name ,description ,cron_expression,bean_class ,job_status,job_group FROM  sys_task
    </select>


    <select id="getTaskList" resultMap="ScheduleJob">
                   SELECT id,job_name ,description ,cron_expression,bean_class ,job_status,job_group FROM  sys_task
                   where 1=1
        <if test="jobStatus != '' and jobStatus != null">
            and job_status =#{jobStatus}
        </if>
    </select>

    <insert id="saveTask" parameterType="com.example.demo.pojo.quartz.ScheduleJob">
        <selectKey  keyProperty="id" resultType="long" order="BEFORE">
            SELECT seq_sys_task.NEXTVAL FROM DUAL
        </selectKey>
        insert into sys_task (id,job_name,description,cron_expression,bean_class,job_status,job_group)
        values(#{id},#{jobName},#{description},#{cronExpression},#{beanClass},'2',#{jobGroup})
    </insert>
    <update id="editTask"  parameterType="com.example.demo.pojo.quartz.ScheduleJob">
        update  sys_task set job_name=#{jobName}, description=#{description},cron_expression=#{cronExpression},
        bean_class=#{beanClass},job_group=#{jobGroup} where id =#{id}
    </update>



    <select id="getTaskById" parameterType="java.lang.Long" resultMap="ScheduleJob">
         SELECT id,job_name ,description ,cron_expression,bean_class ,job_status,job_group FROM  sys_task
                   where id =#{id}
    </select>

    <update id="start" parameterType="java.lang.Long">
        update sys_task set job_status='1' where id =#{id}
    </update>

    <update id="stop" parameterType="java.lang.Long">
        update sys_task set job_status='2' where id =#{id}
    </update>

    <update id="delTask" parameterType="java.lang.Long">
        update sys_task set job_status='3' where id =#{id}
    </update>

    <delete id="delTaskForever" parameterType="java.lang.Long">
         delete  from sys_task where  id =#{id}
    </delete>
</mapper>